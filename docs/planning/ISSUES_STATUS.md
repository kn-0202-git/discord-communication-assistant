# 課題対応表

開発中に発見された課題とその対応状況を記録する。

## 凡例

| status | 意味 |
|--------|------|
| 🔴 未対応 | まだ着手していない |
| 🟡 対応中 | 作業中 |
| ⏸️ 保留 | 意図的に後回し |
| 🟢 完了 | 解決済み |

| 優先度 | 意味 |
|--------|------|
| 高 | 開発がブロックされる、すぐに対応必要 |
| 中 | 実装フェーズで対応すればOK |
| 低 | 体裁・改善、いつでも対応可 |

---

## 課題一覧（その他）

| # | 課題 | 優先度 | status | 発見日 | 対応日 | 備考 |
|---|------|--------|--------|--------|--------|------|
| - | pyrightがCIにない | 低 | 🔴 未対応 | 2025-01-01 | - | GitHub Actions更新で対応 |
| - | DECISIONS.mdの日付が仮 | 低 | 🔴 未対応 | 2025-01-01 | - | 2025-01-XXを正式日付に |

---

## プロセス改善

開発プロセス上の問題とその対応状況を記録する。

| # | 問題 | 優先度 | status | 発見日 | 対応日 | 対策 |
|---|------|--------|--------|--------|--------|------|
| P1 | 文書作成忘れ | 高 | 🟢 完了 | 2025-01-04 | 2025-01-06 | TodoWrite必須項目化、空ファイル事前作成 |
| P2 | 記録作成の遅延・忘れ（再発） | 高 | 🟢 完了 | 2025-01-06 | 2025-01-06 | ルール6-8追加、Issue開始時に空ファイル作成義務化、Issue完了直後に記録 |

### 問題解決フロー

```
問題発生
    ↓
① このセクションに記録（問題内容、発見日、優先度）
    ↓
② 対応中は status を 🟡 に
    ↓
③ 解決したら:
   - docs/reference/TROUBLESHOOTING.md に詳細を追加
   - docs/logs/DEVELOPMENT_LOG.md に記録
   - このセクションを 🟢 完了 に
```

---

## 未完了課題の優先順位（議論結果）

### 方針

- 直近リスク（運用障害/品質低下）を先に潰す
- 依存関係があるものは前段から着手
- 長期項目は後回し（並行はしない）

### 優先順位

| 優先 | 対象 | 理由 |
|------|------|------|
| P0 | G1-G4, #33 | 運用リスク/ユーザー価値に直結、即時効果が高い |
| P1 | #26-29 | クラウド移行の前提（Step4） |
| P2 | #22-25 | Step4完了後に着手（Fly.io移行） |
| P3 | #34-35 | 移行完了後の統合/本番テスト |
| P4 | #36-39 | Phase 3（RAG）は後続フェーズで着手 |
| P5 | その他（pyright CI, DECISIONS日付） | 低優先・随時対応 |

### 実施順（直近）

1. G1 → G4 → G2 → G3
2. #33
3. #26 → #27 → #28 → #29

---

## Phase 2 課題一覧

### Step 1: 技術課題解消

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #15 | datetime.utcnow()修正 | 中 | 🟢 完了 | datetime.now(UTC)に置換 |
| #16 | GuildListenerテスト追加 | 低 | 🟢 完了 | on_guild_join/removeテスト |
| #17 | レート制限対策 | 中 | 🟢 完了 | asyncio.Semaphore/クールダウン実装 |

### Step 2: リマインダー機能

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #18 | Reminderテーブル | 高 | 🟢 完了 | モデル・CRUD完了（8テスト） |
| #19 | /remind実装 | 高 | 🟢 完了 | リマインダー登録（11テスト） |
| #20 | /reminders実装 | 高 | 🟢 完了 | 一覧表示（4テスト） |
| #21 | 期限通知機能 | 高 | 🟢 完了 | ReminderNotifier（5テスト） |

### Step 3: クラウド移行（Fly.io）

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #22 | Dockerfile作成 | 高 | 🔴 未対応 | ローカルでビルド成功 |
| #23 | fly.toml設定 | 高 | 🔴 未対応 | Fly CLI設定完了 |
| #24 | SQLite Volume対応 | 高 | 🔴 未対応 | データ永続化確認 |
| #25 | Fly.ioデプロイ | 高 | 🔴 未対応 | 本番稼働確認 |

### Step 4: Google Drive連携

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #26 | GoogleDriveStorage実装 | 中 | 🔴 未対応 | StorageProviderインターフェース準拠 |
| #27 | OAuth設定 | 中 | 🔴 未対応 | 認証フロー完了 |
| #28 | /saveコマンド | 中 | 🔴 未対応 | 手動アップロード成功 |
| #29 | 自動アップロード | 中 | 🔴 未対応 | config設定で制御 |

### Step 5: 通話録音・文字起こし

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #30 | VoiceSession実装 | 高 | 🟢 完了 | テーブル・CRUD完了（7テスト） |
| #31 | 通話録音機能 | 高 | 🟢 完了 | /record コマンド・VoiceRecorder実装（16テスト） |
| #32 | Whisperプロバイダー | 高 | 🟢 完了 | TranscriptionProvider・WhisperProvider（11テスト） |
| #33 | /transcribe実装 | 高 | 🟢 完了 | 文字起こし結果表示 |

### Step 5.5: Geminiレビュー対応（並行）

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| G1 | MAX_ATTACHMENT_SIZEのconfig化 | 高 | 🟢 完了 | config.yaml反映 + テスト更新 |
| G2 | TokenCounter導入 | 高 | 🟢 完了 | docs/specs/TOKEN_COUNTER.md作成 + 長文トリム確認 |
| G3 | MagicMock autospec化 | 高 | 🟢 完了 | 主要テストのautospec化完了 |
| G4 | 共有aiohttpセッション導入 | 高 | 🟢 完了 | セッション再利用の確認 |

### Step 6: 統合・テスト

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #34 | Phase 2統合テスト | 高 | 🔴 未対応 | 全機能連携確認 |
| #35 | 本番運用テスト | 高 | 🔴 未対応 | 複数社で動作確認 |

---

## Phase 3 課題一覧（RAG）

| Issue | 課題 | 優先度 | status | 備考 |
|-------|------|--------|--------|------|
| #36 | Documentテーブル | 高 | 🔴 未対応 | 資料メタデータ保存 |
| #37 | ベクトル化 | 高 | 🔴 未対応 | Embeddings保存・検索 |
| #38 | /ask実装 | 高 | 🔴 未対応 | RAG回答生成 |
| #39 | Phase 3統合テスト | 高 | 🔴 未対応 | 全機能確認 |

---

## 完了した課題

| # | 課題 | 優先度 | 発見日 | 対応日 | 備考 |
|---|------|--------|--------|--------|------|
| - | Codex: naive/aware datetime比較 | 高 | 2025-01-08 | 2025-01-08 | summarizer.pyでUTC使用 |
| - | Codex: OpenAI固定問題 | 中 | 2025-01-08 | 2025-01-08 | 全プロバイダー対応 |
| - | Codex: パストラバーサル | 中 | 2025-01-08 | 2025-01-08 | ファイル名サニタイズ |
| - | Codex: サイズ上限なし | 中 | 2025-01-08 | 2025-01-08 | 25MB上限追加 |
| - | ドキュメント欠如（7ファイル） | 高 | 2025-01-01 | 2025-01-01 | setup_docs.shで作成 |
| - | Issue #1 DB設計・実装 | 高 | 2025-01-01 | 2025-01-01 | 6モデル・10テスト完了 |
| 2 | src/main.pyがない | 中 | 2025-01-01 | 2025-01-04 | Issue #2で基盤実装完了 |
| - | Issue #2 Discord Bot基盤 | 高 | 2025-01-04 | 2025-01-04 | BotClient・Listener・10テスト完了 |
| - | Issue #3 メッセージ＋添付ファイル保存 | 高 | 2025-01-04 | 2025-01-04 | #4と統合・42テスト・手動テスト成功 |
| - | Issue #5 Workspace/Room分離 | 高 | 2025-01-04 | 2025-01-04 | ユニットテスト完了。実機テスト（複数サーバー）は#14で実施予定 |
| - | Issue #7 AI基盤（base, router） | 高 | 2025-01-05 | 2025-01-05 | AIProvider抽象クラス・AIRouter・18テスト完了 |
| 1 | config.yamlがない | 中 | 2025-01-01 | 2025-01-05 | Issue #7で作成済み |
| - | Issue #8 OpenAIプロバイダー | 高 | 2025-01-05 | 2025-01-05 | generate/embed・9テスト完了 |
| - | Issue #9 /summaryコマンド | 高 | 2025-01-05 | 2025-01-05 | Summarizer・10テスト完了 |
| - | Issue #10 /searchコマンド | 高 | 2025-01-05 | 2025-01-05 | キーワード検索完了 |
| - | Issue #11 統合Room通知 | 高 | 2025-01-05 | 2025-01-05 | AggregationNotifier・9テスト完了 |
| - | Issue #12 他AIプロバイダー | 高 | 2025-01-05 | 2025-01-05 | Anthropic/Google/Groq・27テスト完了 |
| - | Issue #13 統合テスト | 高 | 2025-01-05 | 2025-01-05 | 7統合テスト完了 |
| - | Issue #14 試験運用準備 | 高 | 2025-01-05 | 2025-01-05 | main.py統合・120テスト完了 |

---

## 更新ルール

- 課題発見時：課題一覧に追加
- 対応開始時：statusを🟡に変更
- 対応完了時：「完了した課題」に移動、対応日を記入
- レビュー時：新しい課題があれば追加
