# R-issue16

- レビューの目的: マルチLLM切替を前提とした開発プロセス/文書体系の適合性を再評価し、記録の一貫性と参照導線の改善方針を合意する
- 内容（参照文書）:
  - docs/rules/CORE_RULES.md
  - CLAUDE.md
  - codex_process.md
  - GEMINI.md
  - docs/INDEX.md
  - docs/templates/*.md
  - docs/logs/DEVELOPMENT_SUMMARY.md
  - docs/logs/DEVELOPMENT_LOG.md
  - docs/handover/HANDOVER_*.md
  - docs/archive/conversations/CONVERSATION_LOG_*.md
  - docs/reference/R-issue_summary.md
- 日付: 2026-01-18
- レビュー者: Codex
- ステータス: in_progress

LLM1（レビュー者）
- 重要指摘:
  - SSOTはCORE_RULESに集約済みだが、参照導線/更新同期が分散し、起点の誤読や更新漏れが起きやすい
  - 会話ログ/開発ログ/引き継ぎのテンプレ適用とAgent記載が不均一で、監査性が揺れている
  - 「最新状態の一次情報」が文書間でズレる事例（INDEXの最新引き継ぎ、DEVELOPMENT_SUMMARYのテスト数/直近更新）がある
  - ログ欠損時の代替ルールはCORE_RULESにあるが、他LLMガイドや運用チェックでの強制力が弱い
- 課題:
  - 共通ルールの参照順序/更新責任の明確化（誰が、いつ、どの文書を更新するか）
  - テンプレ準拠の担保（Agent欄・要約層・更新時刻の標準化）
  - 鳥瞰/詳細の二層構造の維持と最新状態の一本化
- 専門家レビュー（議論）:
  - プロンプトエンジニア:
    - 共通ルールのSSOTは正しいが、エージェント固有ガイドの差分が明示されていない
    - 「LLM切替時の最小参照セット」と「出力制約」を単独の短文ルールにまとめるべき
  - AIエンジニア:
    - 参照範囲が広いと復帰コストが上がるため、要約層の強制とログの粒度統一が必要
    - ログ欠損時の代替記録（DEVELOPMENT_LOG詳細化）を全LLMで標準化したい
  - 文書管理:
    - INDEXが最新を指していない場合、起点として機能しない
    - 「起点→カテゴリ→詳細」の導線は維持しつつ、更新責任者と頻度を明文化すべき
  - プロマネ:
    - 進捗把握は DEVELOPMENT_SUMMARY + 最新HANDOVER が一次情報であることを固定化する必要
    - 更新漏れ時の検知（チェックリスト/スクリプト）をDoDに組み込むべき
  - 教育者:
    - テンプレ統一により学習効果/再現性が高まる
    - 1ファイルに長文が集まりすぎると学習負荷が増えるため二層構造を守る
  - セキュリティ:
    - 会話ログに機密が混入しやすい。テンプレで「機密禁止/伏字」ルールを前置きするのが有効
    - 代替記録時にgitハッシュを残す運用は監査性向上に寄与
  - QA:
    - テスト結果の粒度が文書で揺れているため、最小形式（コマンド/結果/件数）を必須化する
    - ログ欠損時の理由と補完方法が毎回明記されるべき
- レビュー者意見:
  - 構造は概ね整っているが「参照起点のズレ」「テンプレ未準拠」「最新状態の不一致」がマルチLLM切替で障害になる
  - 既存の枠組みを壊さず、更新責任とテンプレ準拠チェックを運用に組み込むのが最短
- 対応策（計画案）:
  - Phase A: 参照起点の固定化
    - INDEXの「最新引き継ぎ/最新サマリー」を最新に保つ更新責任を明記
    - CORE_RULESに「LLM切替時の最小参照セット」を短文化し、各エージェントガイドから参照する
  - Phase B: テンプレ準拠の強制
    - 会話ログ/開発ログ/引き継ぎにAgent欄・要約層・テスト結果の最小形式を必須化
    - テンプレ非準拠時は scripts/check_template_compliance.sh をDoD前に実行
  - Phase C: 最新状態の一致性チェック
    - DEVELOPMENT_SUMMARY/INDEX/HANDOVER の整合性チェック項目をDoDに追加
    - 「ログ欠損時の代替記録」文言を全ガイドに明記
  - Phase D: 文書体系の鳥瞰整理
    - 鳥瞰: docs/INDEX.md と docs/logs/DEVELOPMENT_SUMMARY.md を起点に維持
    - 詳細: logs/handover/archive の現行区分を維持（統合は不要）
- レビューされる側への依頼文:
  - 以下のR-issue16について、LLM2（レビューされる側）欄を記入してください。
  - 観点: 指摘に対する考え / 対応方法 / 対応結果

LLM2（Gemini 2.0 Flash）
- 指摘に対する考え:
  - 提案された「鳥瞰/詳細の二層構造維持」と「テンプレート準拠の強制」に完全に同意する。
  - 実態調査の結果、`docs/INDEX.md` が既に古くなっており（最終更新1/11）、鳥瞰機能が失われていることを確認した。
  - `check_template_compliance.sh` は存在するが、ワークフローに組み込まれていないため形骸化している。
- 対応方法（補足提案）:
  1. **起点の自動更新**: `INDEX.md` の「最新の引き継ぎ」等の項目を、スクリプトで自動更新するか、タスク終了時の必須手順にする。
  2. **DoDへの組み込み**: `CORE_RULES.md` のTask Completion基準に「`check_template_compliance.sh` がPassすること」を明記する。
  3. **ログ欠損時のルール**: ログが残っていない場合、git履歴から要約を生成して `DEVELOPMENT_LOG.md` に追記する「回復手順」を策定する。
- 対応結果:
  - 方針合意。次フェーズでの文書改訂を待つ。

LLM3（Claude Opus 4.5）
- 調査日: 2026-01-19
- 指摘に対する考え:
  - 6つの具体的問題を確認:
    1. INDEX.md が最新HANDOVER を指していない（5日古い: 1/11 → 実際は1/18）
    2. DEVELOPMENT_SUMMARY.md のテスト数が矛盾（記載205 vs 実際220）
    3. 会話ログ12/15ファイルがテンプレート非準拠（Agent欄・要約層なし）
    4. check_template_compliance.sh がAgent欄のみチェック（要約層・詳細層未チェック）
    5. スクリプトがワークフローに組み込まれていない（DoDに含まれていない）
    6. テスト結果の粒度が文書で揺れている
  - Phase A（参照起点の固定化）を最優先で実施すべき
  - 過去の会話ログ更新は工数対効果が低いため、今後のルール厳格化を優先
- 対応方法:
  1. **即時対応**: INDEX.md / DEVELOPMENT_SUMMARY.md を更新
  2. **継続対応**: check_template_compliance.sh 強化、DoDへの組み込み
  3. **見送り**: 過去の会話ログ12件の更新（現状維持、今後の新規分から厳格化）
- 対応結果:
  - INDEX.md: 最新HANDOVER(2026-01-18)を指すよう修正
  - DEVELOPMENT_SUMMARY.md: テスト数220に修正
  - ステータス: in_progress
